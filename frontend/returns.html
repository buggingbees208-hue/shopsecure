<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Return Request | ShopSecure</title>

<style>
body {
    background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)),
                url('https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?q=80&w=1350')
                no-repeat center center fixed;
    background-size: cover;
    font-family: 'Poppins', sans-serif;
    margin: 0;
    min-height: 100vh;
}

nav {
    background: rgba(44, 62, 80, 0.95);
    padding: 15px 50px;
    display: flex;
    justify-content: space-between;
}

.logo { color: white; font-size: 22px; font-weight: bold; text-decoration: none; }
.nav-links a { color: #ddd; margin-left: 20px; cursor: pointer; }

.container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 50px 20px;
}

.card {
    background: rgba(255, 255, 255, 0.98);
    padding: 40px;
    border-radius: 12px;
    width: 100%;
    max-width: 450px;
}

label { font-weight: bold; margin-bottom: 6px; display: block; }

input, textarea {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ddd;
}

textarea { height: 100px; resize: none; }

.upload-section {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border: 1px dashed #ccc;
    margin-bottom: 20px;
    text-align: center;
}

button {
    width: 100%;
    padding: 14px;
    background: #e67e22;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 16px;
}

button:hover { background: #d35400; }

#processing-loader {
    display: none;
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(255,255,255,0.9);
    z-index:9999;
    justify-content:center;
    align-items:center;
    flex-direction:column;
}

.loader-spinner {
    width:50px;
    height:50px;
    border:5px solid #f3f3f3;
    border-top:5px solid #e67e22;
    border-radius:50%;
    animation:spin 1s linear infinite;
}

@keyframes spin {
    0%{transform:rotate(0deg);}
    100%{transform:rotate(360deg);}
}
</style>
</head>

<body>

<div id="processing-loader">
    <div class="loader-spinner"></div>
    <p style="margin-top:15px;">Processing your request...</p>
</div>

<nav>
    <a href="index.html" class="logo">üõí ShopSecure</a>
    <div class="nav-links">
        <a href="products.html">Shop</a>
        <a onclick="logout()">Logout</a>
    </div>
</nav>

<div class="container">
<div class="card">

<h2 style="text-align:center;">Return Request</h2>

<label>Order ID:</label>
<input type="text" id="order_id_input" placeholder="Enter your Order ID">

<label>Reason for Return:</label>
<textarea id="reason" placeholder="Describe the issue clearly"></textarea>

<label>Product Photo:</label>
<div class="upload-section">
    <input type="file" id="proof" accept="image/*">
</div>

<button id="submitBtn" onclick="sendReturn()">Submit Request</button>

</div>
</div>

<script>

/* üî• Auto detect Render / Local */
const API =
window.location.hostname === "127.0.0.1" ||
window.location.hostname === "localhost"
? "http://127.0.0.1:8000"
: "https://your-app-name.onrender.com";  // change before deploy

/* üîê Session Check */
window.onload = function() {
    if (!localStorage.getItem("user_id")) {
        alert("Session expired. Please login again.");
        window.location.href = "login.html";
    }
};

function logout() {
    localStorage.clear();
    window.location.href = "login.html";
}

async function sendReturn() {

    const loader = document.getElementById("processing-loader");
    const btn = document.getElementById("submitBtn");

    const orderId = document.getElementById("order_id_input").value.trim();
    const proofFile = document.getElementById("proof").files[0];
    const reason = document.getElementById("reason").value.trim();
    const userId = localStorage.getItem("user_id");

    if (!orderId || !proofFile || !reason) {
        return alert("Please fill all details.");
    }

    /* üîé Image validation */
    if (!proofFile.type.startsWith("image/")) {
        return alert("Only image files allowed.");
    }

    loader.style.display = "flex";
    btn.disabled = true;

    let f = new FormData();
    f.append("order_id", orderId);
    f.append("user_id", userId);   // üîê safer than email
    f.append("reason", reason);
    f.append("image", proofFile);

    try {
        const res = await fetch(`${API}/return`, {
            method: "POST",
            body: f
        });

        const data = await res.json();

        loader.style.display = "none";
        btn.disabled = false;

        if (res.ok) {
            alert("Return request submitted successfully. Our team will review it.");
            window.location.href = "products.html";
        } else {
            alert(data.detail || "Invalid order or unauthorized request.");
        }

    } catch (err) {
        loader.style.display = "none";
        btn.disabled = false;
        alert("Server error. Please try again later.");
    }
}

</script>

</body>
</html>
